listen {
  port = 4040
  
  // "metrics_endpoint" can be used to configure an alternative metrics URL
  // path. Default value is "/metrics".
  //
  //   metrics_endpoint = "/metrics"
}

namespace "nginx" {
  source = {
    files = [
      "/var/log/nginx/access_prometheus.log",
    ]
  }

  format = "$remote_addr - $remote_user [$time_local] \"$request\" \"$request_id\" $status \"$upstream_cache_status\" $body_bytes_sent \"$http_referer\" \"$http_user_agent\" \"$http_x_forwarded_for\" rt=$request_time uct=\"$upstream_connect_time\" uht=\"$upstream_header_time\" urt=\"$upstream_response_time\""
  
  labels {
    app = "odoo"
    website = "ocms"
  }

  relabel "request_method" {
    from = "request"
    split = 1
  }
  relabel "request_url" {
    from = "request"
    split = 2
  }
 
  relabel "request_url_formated" {
    from = "request"
    split = 2

    match "/web/assets/.*" {
      replacement = "/web/assets"
    }

    match "([^?]+).*" {
      replacement = "$1"
    }
  }
 

  relabel "remote_addr" {
    from = "remote_addr"
  }

  relabel "cache" {
    from = "upstream_cache_status"
  }

  relabel "remote_user" {
    from = "remote_user"
  }  


  histogram_buckets = [.005, .01, .025, .05, .1, .25, .5, 1, 2.5, 5, 10]

}